<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="../layout/default">
<head></head>
<body>
<div>
  <header></header>
  <aside>/</aside>

  <!-- Content Wrapper. Contains page content -->
    <div layout:fragment="content" class="content-wrapper" th:with="UPDATE_CD = ${T(org.openpaas.paasta.portal.web.admin.common.Constants).CUD_U}, INSERT_CD = ${T(org.openpaas.paasta.portal.web.admin.common.Constants).CUD_C} ">

      <!-- Content Header (Page header) -->
      <section class="content-header">
        <h1>
          대시보드
        </h1>
      </section>

      <!-- Main content -->
      <section class="content">

        <!-- Small box-->
        <div class="row">
          <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-aqua">
              <div class="inner">
                <h3 id="organizationCount">&nbsp;</h3>

                <p>조직 수</p>
              </div>
              <div class="icon">
                <i class="ion ion-ios-people"></i>
              </div>
              <!-- <a href="#" class="small-box-footer">More info
                <i class="fa fa-arrow-circle-right"></i>
              </a> -->
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-green">
              <div class="inner">
                <h3 id="spaceCount">&nbsp;</h3>

                <p>공간 수</p>
              </div>
              <div class="icon">
                <i class="ion ion-ios-pie-outline"></i>
              </div>
              <!-- <a href="#" class="small-box-footer">More info
                <i class="fa fa-arrow-circle-right"></i>
              </a> -->
            </div>
          </div>
          <!-- ./col -->

          <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-yellow">
              <div class="inner">
                <h3 id="applicationCount">&nbsp;</h3>

                <p>APP 수</p>
              </div>
              <div class="icon">
                <i class="ion ion-cube"></i>
              </div>
              <!-- <a href="#" class="small-box-footer">More info
                <i class="fa fa-arrow-circle-right"></i>
              </a> -->
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-red">
              <div class="inner">
                <h3 id="userCount">&nbsp;</h3>

                <p>사용자 수</p>
              </div>
              <div class="icon">
                <i class="ion ion-man"></i>
              </div>
              <!-- <a href="#" class="small-box-footer">More info
                <i class="fa fa-arrow-circle-right"></i>
              </a> -->
            </div>
          </div>
          <!-- ./col -->
        </div>
        <!-- Small box-->

        <div class="row">

          <!-- /.col (LEFT) -->
          <div class="col-md-12">

            <!-- BAR CHART -->
            <div class="box box-success">
              <div class="box-header with-border">
                <h3 class="box-title"> </h3>

                <!-- <div class="box-tools pull-right">
                  <button type="button" class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-box-tool" data-widget="remove">
                    <i class="fa fa-times"></i>
                  </button>
                </div> -->
              </div>
              <div class="box-body">
                <div class="chart">
                  <canvas id="barChart" style="height: 125px; width: 341px;" width="341" height="125"></canvas>
                </div>
              </div>
              <!-- /.box-body -->
            </div>
            <!-- /.box -->

          </div>
          <!-- /.col (RIGHT) -->
        </div>
        <!-- /.row -->

      </section>
      <!-- /.content -->
    </div>
  <!-- /.content-wrapper -->

  <footer></footer>

</div>
<!-- ./wrapper -->
<script th:inline="javascript" type="text/javascript" layout:fragment="custom-script">
  /*<![CDATA[*/


  var MAIN_DASH_BOARD_URL = "/main";
  var MAIN_DASH_BOARD_ORGANIZATION_URL = "/main/organization";
  var TOTAL_COUNT_LIST_PROC_URL = "/main/getTotalCountList";
  var TOTAL_ORGANIZATION_LIST_PROC_URL = "/main/getTotalOrganizationList";
  var TOTAL_SPACE_LIST_PROC_URL = "/main/getTotalSpaceList";


  // GET LIST
  var getTotalCountList = function() {
    procCallAjax(TOTAL_COUNT_LIST_PROC_URL, {}, procCallbackGetTotalCountList);
  };


  // GET LIST CALLBACK
  var procCallbackGetTotalCountList = function(data) {
    var resultList = data.list[0];
    var organizationCount = $('#organizationCount');
    var spaceCount = $('#spaceCount');
    var applicationCount = $('#applicationCount');
    var userCount = $('#userCount');

    organizationCount.text(resultList.organizationCount);
    spaceCount.text(resultList.spaceCount);
    applicationCount.text(resultList.applicationCount);
    userCount.text(resultList.userCount);

//    organizationCount.fadeIn();
//    spaceCount.fadeIn();
//    applicationCount.fadeIn();
//    userCount.fadeIn();

    var organizationId = $('#organizationId').val();

    if ('' == organizationId) {
      getTotalOrganizationList();
    } else {
      getTotalSpaceList(organizationId);
    }
  };


  // GET LIST
  var getTotalOrganizationList = function() {
    procCallAjax(TOTAL_ORGANIZATION_LIST_PROC_URL, {}, procCallbackGetTotalOrganizationList);
  };


  // GET LIST CALLBACK
  var procCallbackGetTotalOrganizationList = function(data) {
    setOrganizationChart(data);
  };


  // GET LIST
  var getTotalSpaceList = function(reqOrganizationId) {
    procCallAjax(TOTAL_SPACE_LIST_PROC_URL, {organizationId : reqOrganizationId}, procCallbackGetTotalSpaceList);
  };


  // GET LIST CALLBACK
  var procCallbackGetTotalSpaceList = function(data) {
    setSpaceChart(data);
  };




  // SET MAIN CHART
  var setOrganizationChart = function(data) {
    var resultList = data.list;
    var chartContainer = $('#chartContainer');
    var listLength = resultList.length;

    // SET OPTIONS
    var chartOptions = setOrganizationChartOptions(resultList);

    // EXECUTE CHART
    chartContainer.css('height', listLength * 80 + 'px');
    chartContainer.fadeIn();
    chartContainer.highcharts(chartOptions);

    // SET LINK
    var arrayOrganizationName = $('.highcharts-xaxis-labels text');

    for (var i = 0; i < listLength; i++) {
      arrayOrganizationName[i].onclick = function() {
        procMovePage(MAIN_DASH_BOARD_ORGANIZATION_URL + "/" + getOrganizationId($(this).children().text(), resultList));
      };
    }

    $('.highcharts-xaxis-labels tspan').on("mouseover", function() {
      $(this).attr('style', 'cursor: pointer;');
    });
  };






  // GET ORGANIZATION ID
  var getOrganizationId = function(reqOrganizationName, reqList) {
    var resultList = reqList;
    var listLength = resultList.length;
    var resultOrganizationId = '';

    for (var i = 0; i < listLength; i++) {
      if (reqOrganizationName == resultList[i].organizationName) {
        resultOrganizationId = resultList[i].organizationId;
      }
    }

    return resultOrganizationId;
  };


  // SET CHART OPTIONS
  var setOrganizationChartOptions = function(resultList) {
    var listLength = resultList.length;
    var arrayOrganizationName = [];
    var arraySpaceCount = [];
    var arrayApplicationCount = [];
    var arrayUserCount = [];
    var organizationName = '';

    for (var i = 0; i < listLength; i++) {
      organizationName = resultList[i].organizationName;
      arrayOrganizationName.push(organizationName);

      for (var j = 0; j < listLength; j++) {
        if (organizationName == resultList[j].organizationName) {
          arraySpaceCount.push(resultList[j].spaceCount);
          arrayApplicationCount.push(resultList[j].applicationCount);
          arrayUserCount.push(resultList[j].userCount);
        }
      }
    }

    arrayOrganizationName.join(',');
    arraySpaceCount.join(',');
    arrayApplicationCount.join(',');
    arrayUserCount.join(',');

    return {
      legend: {
        verticalAlign: 'top',
        align: 'left',
        itemStyle: {
          'font-size': '16px', 'font-family':'"Spoqa Han Sans","Helvetica Neue",Helvetica,Arial,sans-serif', 'color':'#494747'
        }
      },
      colors: ['#77807e', '#c0c0c0', '#738de0'],
      chart: {
        type: 'bar'
      },
      title: {
        text: ''
      },
      subtitle: {
        text: ''
      },
      xAxis: {
        categories: arrayOrganizationName,
        labels: {
          style: {'font-size': '16px', 'font-family':'"Spoqa Han Sans","Helvetica Neue",Helvetica,Arial,sans-serif', 'color':'#494747'}
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: ''
        }
      },
      plotOptions: {
        bar: {
          dataLabels: {
            enabled: true
          }
        }
      },
      credits: {
        enabled: false
      },
      series: [{
        name: 'APP',
        data: arrayApplicationCount
      }, {
        name: '공간',
        data: arraySpaceCount
      }, {
        name: '사용자',
        data: arrayUserCount
      }]
    };
  };


  // SET MAIN CHART
  var setSpaceChart = function(data) {
    var resultList = data.list;
    var chartContainer = $('#chartContainer');
    var listLength = resultList.length;

    // CHECK EMPTY SPACE
    if (0 == listLength) {
      //setViewEmptySpaceMessageArea();
      return false;
    }

    // SET OPTIONS
    var chartOptions = setSpaceChartOptions(resultList);

    // EXECUTE CHART
//    chartContainer.css('height', listLength * 80 + 'px');
//    chartContainer.fadeIn();
//    chartContainer.highcharts(chartOptions);

    // VIEW BUTTON
    $('#btnMoveMainArea').fadeIn();

    // BIND :: BUTTON EVENT
    $("#btnMoveMain").on("click", function() {
      procMovePage(MAIN_DASH_BOARD_URL);
    });
  };


  // VIEW EMPTY SPACE MESSAGE AREA
//  var setViewEmptySpaceMessageArea = function () {
//    $('#emptySpaceMessageArea').fadeIn();
//    $('#btnMoveMainArea').fadeIn();
//
//    $("#btnMoveMain").on("click", function() {
//      procMovePage(MAIN_DASH_BOARD_URL);
//    });
//  };


  // SET CHART OPTIONS
  var setSpaceChartOptions = function(resultList) {
    var listLength = resultList.length;
    var arraySpaceName = [];
    var arrayApplicationCount = [];
    var spaceName = '';

    for (var i = 0; i < listLength; i++) {
      spaceName = resultList[i].spaceName;
      arraySpaceName.push(spaceName);

      for (var j = 0; j < listLength; j++) {
        if (spaceName == resultList[j].spaceName) {
          arrayApplicationCount.push(resultList[j].applicationCount);
        }
      }
    }

    arraySpaceName.join(',');
    arrayApplicationCount.join(',');

    return {
      colors: ['#77807e', '#c0c0c0', '#738de0'],

      chart: {
        type: 'bar'
      },
      title: {
        text: ''
      },
      subtitle: {
        text: ''
      },
      xAxis: {
        categories: arraySpaceName,
        labels: {
          style: {'font-size': '16px', 'font-family':'"Spoqa Han Sans","Helvetica Neue",Helvetica,Arial,sans-serif', 'color':'#494747'}
        }
      },
      yAxis: {
        min: 0,
        title: {
          text: ''
        }
      },
      plotOptions: {
        bar: {
          dataLabels: {
            enabled: true
          }
        }
      },
      legend: {
        verticalAlign: 'top',
        align: 'left',
        itemStyle: {
          'font-size': '16px', 'font-family':'"Spoqa Han Sans","Helvetica Neue",Helvetica,Arial,sans-serif', 'color':'#494747'
        }
      },
      credits: {
        enabled: false
      },
      series: [{
        name: 'APP',
        data: arrayApplicationCount
      }]
    };
  };


  // INIT PAGE
  var procInitPage = function() {
    getTotalCountList();
  };


  // ON LOAD
  $(document.body).ready(function() {
    procInitPage();
    //procAlert("normal", '<spring:message code="common.system.welcome.message" />');

    console.log("ASJKJASLJDK");
    var horizontalBarChartData = {
      labels: ["Category 1", "Category 2", "Category 3", "Interview 4", "Category 5", "Category 6", "Category 7"],
      datasets: [{
        backgroundColor: "#00b0f0",
        data: [80,10,15,5,20,3,25]
      }]

    };
    var ctx = document.getElementById("barChart").getContext("2d");
    var myHorizontalBar = new Chart(ctx, {
      type: 'horizontalBar',
      data: horizontalBarChartData,
      options: {

        scales: {
          yAxes:[{
            barThickness: 20,
            ticks: {
              beginAtZero:true,
              mirror: true,
            },
          }],
        },
        responsive: true,
        legend: {
          display: false,
        },
        title: {
          display: true,
          text: 'Horizontal Bar Chart'
        },
        animation: {
          duration: 1,
          onComplete () {
            const chartInstance = this.chart;
            const ctx = chartInstance.ctx;
            const dataset = this.data.datasets[0];
            const meta = chartInstance.controller.getDatasetMeta(0);

            Chart.helpers.each(meta.data.forEach((bar, index) => {
                      const label = this.data.labels[index];
            const labelPositionX = 20;
            const labelWidth = ctx.measureText(label).width + labelPositionX;

            ctx.textBaseline = 'middle';
            ctx.textAlign = 'left';
            ctx.fillStyle = '#333';
            ctx.fillText(label, labelPositionX, bar._model.y);
          }));
          }
        }
      }
    });


  });



















//
//  $(function () {
//    /* ChartJS
//     * -------
//     * Here we will create a few charts using ChartJS
//     */
//
//    //-------------
//    //- BAR CHART -
//    //-------------
//    var barChartCanvas = $('#barChart').get(0).getContext('2d');
//    var barChart = new Chart(barChartCanvas);
//
//
//    var barChartData = {
//      labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
//      datasets: [
//        {
//          label: 'Electronics',
//          fillColor: 'rgba(210, 214, 222, 1)',
//          strokeColor: 'rgba(210, 214, 222, 1)',
//          pointColor: 'rgba(210, 214, 222, 1)',
//          pointStrokeColor: '#c1c7d1',
//          pointHighlightFill: '#fff',
//          pointHighlightStroke: 'rgba(220,220,220,1)',
//          data: [65, 59, 80, 81, 56, 55, 40]
//        },
//        {
//          label: 'Digital Goods',
//          fillColor: 'rgba(60,141,188,0.9)',
//          strokeColor: 'rgba(60,141,188,0.8)',
//          pointColor: '#3b8bba',
//          pointStrokeColor: 'rgba(60,141,188,1)',
//          pointHighlightFill: '#fff',
//          pointHighlightStroke: 'rgba(60,141,188,1)',
//          data: [28, 48, 40, 19, 86, 27, 90]
//        }
//      ]
//    }
//
//    barChartData.datasets[1].fillColor = '#00a65a'
//    barChartData.datasets[1].strokeColor = '#00a65a'
//    barChartData.datasets[1].pointColor = '#00a65a'
//    var barChartOptions = {
//      //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
//      scaleBeginAtZero: true,
//      //Boolean - Whether grid lines are shown across the chart
//      scaleShowGridLines: true,
//      //String - Colour of the grid lines
//      scaleGridLineColor: 'rgba(0,0,0,.05)',
//      //Number - Width of the grid lines
//      scaleGridLineWidth: 1,
//      //Boolean - Whether to show horizontal lines (except X axis)
//      scaleShowHorizontalLines: true,
//      //Boolean - Whether to show vertical lines (except Y axis)
//      scaleShowVerticalLines: true,
//      //Boolean - If there is a stroke on each bar
//      barShowStroke: true,
//      //Number - Pixel width of the bar stroke
//      barStrokeWidth: 2,
//      //Number - Spacing between each of the X value sets
//      barValueSpacing: 5,
//      //Number - Spacing between data sets within X values
//      barDatasetSpacing: 1,
//      //Boolean - whether to make the chart responsive
//      responsive: true,
//      maintainAspectRatio: true
//    }
//
//    barChartOptions.datasetFill = false
//    barChart.Bar(barChartData, barChartOptions)
//  })

  /*]]>*/
</script>


</body>
</html>
