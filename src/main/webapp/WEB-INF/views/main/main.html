<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="../layout/default">
<head></head>
<body>
<div>
  <header></header>
  <aside>/</aside>

  <!-- Content Wrapper. Contains page content -->
    <div layout:fragment="content" class="content-wrapper" th:with="UPDATE_CD = ${T(org.openpaas.paasta.portal.web.admin.common.Constants).CUD_U}, INSERT_CD = ${T(org.openpaas.paasta.portal.web.admin.common.Constants).CUD_C} ">

      <!-- Content Header (Page header) -->
      <section class="content-header">
        <h1>
          대시보드
        </h1>
      </section>

      <!-- Main content -->
      <section class="content">

        <!-- Small box-->
        <div class="row">
          <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-aqua">
              <div class="inner">
                <h3 id="organizationCount">&nbsp;</h3>

                <p>조직 수</p>
              </div>
              <div class="icon">
                <i class="ion ion-ios-people"></i>
              </div>
              <!-- <a href="#" class="small-box-footer">More info
                <i class="fa fa-arrow-circle-right"></i>
              </a> -->
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-green">
              <div class="inner">
                <h3 id="spaceCount">&nbsp;</h3>

                <p>공간 수</p>
              </div>
              <div class="icon">
                <i class="ion ion-ios-pie-outline"></i>
              </div>
              <!-- <a href="#" class="small-box-footer">More info
                <i class="fa fa-arrow-circle-right"></i>
              </a> -->
            </div>
          </div>
          <!-- ./col -->

          <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-yellow">
              <div class="inner">
                <h3 id="applicationCount">&nbsp;</h3>

                <p>APP 수</p>
              </div>
              <div class="icon">
                <i class="ion ion-cube"></i>
              </div>
              <!-- <a href="#" class="small-box-footer">More info
                <i class="fa fa-arrow-circle-right"></i>
              </a> -->
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-xs-6">
            <!-- small box -->
            <div class="small-box bg-red">
              <div class="inner">
                <h3 id="userCount">&nbsp;</h3>

                <p>사용자 수</p>
              </div>
              <div class="icon">
                <i class="ion ion-man"></i>
              </div>
              <!-- <a href="#" class="small-box-footer">More info
                <i class="fa fa-arrow-circle-right"></i>
              </a> -->
            </div>
          </div>
          <!-- ./col -->
        </div>
        <!-- Small box-->

        <div class="row">

          <!-- /.col (LEFT) -->
          <div class="col-md-12">

            <!-- BAR CHART -->
            <div class="box box-success">
              <div class="box-header with-border">
                <h3 class="box-title"> </h3>

                <!-- <div class="box-tools pull-right">
                  <button type="button" class="btn btn-box-tool" data-widget="collapse">
                    <i class="fa fa-minus"></i>
                  </button>
                  <button type="button" class="btn btn-box-tool" data-widget="remove">
                    <i class="fa fa-times"></i>
                  </button>
                </div> -->
              </div>
              <div class="box-body">
                <div class="chart">
                  <canvas id="barChart" style="height: 400px; width: 341px;" width="341" height="180"></canvas>
                </div>
              </div>
              <!-- /.box-body -->
            </div>
            <!-- /.box -->

          </div>
          <!-- /.col (RIGHT) -->
        </div>
        <!-- /.row -->
        <input type="hidden" id="organizationId" name="organizationId" th:value="${ORGANIZATION_ID}" th:default="''"/>
      </section>
      <!-- /.content -->
    </div>
  <!-- /.content-wrapper -->

  <footer></footer>

</div>
<!-- ./wrapper -->
<script th:inline="javascript" type="text/javascript" layout:fragment="custom-script">
  /*<![CDATA[*/


  var MAIN_DASH_BOARD_URL = "/main";
  var MAIN_DASH_BOARD_ORGANIZATION_URL = "/main/organization";
  var TOTAL_COUNT_LIST_PROC_URL = "/main/getTotalCountList";
  var TOTAL_ORGANIZATION_LIST_PROC_URL = "/main/getTotalOrganizationList";
  var TOTAL_SPACE_LIST_PROC_URL = "/main/getTotalSpaceList";

  // ON LOAD
  $(document.body).ready(function() {
    procInitPage();
//    drawChart();
    //procAlert("normal", '<spring:message code="common.system.welcome.message" />');
  });

  // Init
  var procInitPage = function() {
    getTotalCountList();  // 조직 / 공간 / 앱 /사용자 수 조회
    getChartList();       // 조직 / 공간 차트 조회
  };

  // GET LIST
  var getTotalCountList = function() {
    procCallAjax2(TOTAL_COUNT_LIST_PROC_URL,"GET", {}, procCallbackGetTotalCountList);
  };

  // GET LIST CALLBACK
  var procCallbackGetTotalCountList = function(data) {
    var resultList = data.list[0];
    var organizationCount = $('#organizationCount');
    var spaceCount = $('#spaceCount');
    var applicationCount = $('#applicationCount');
    var userCount = $('#userCount');

    organizationCount.text(resultList.organizationCount);
    spaceCount.text(resultList.spaceCount);
    applicationCount.text(resultList.applicationCount);
    userCount.text(resultList.userCount);
  };

  var getChartList = function(){
    var organizationId = $('#organizationId').val();
    if ('' == organizationId) {
      procCallAjax2(TOTAL_ORGANIZATION_LIST_PROC_URL,"GET", {}, procCallbackGetTotalOrganizationList);
    } else {
      procCallAjax2(TOTAL_SPACE_LIST_PROC_URL,"GET", {organizationId : organizationId}, procCallbackGetTotalSpaceList);
    }
  };

  // '조직'차트 CALLBACK
    var procCallbackGetTotalOrganizationList = function(data) {
      var resultList = data.list;
      var listLength = resultList.length;
      var arrayOrganizationName = [];
      var arraySpaceCount = [];
      var arrayApplicationCount = [];
      var arrayUserCount = [];
      var organizationName = '';

      for (var i = 0; i < listLength; i++) {
        organizationName = resultList[i].organizationName;
        arrayOrganizationName.push(organizationName);

        for (var j = 0; j < listLength; j++) {
          if (organizationName == resultList[j].organizationName) {
            arraySpaceCount.push(resultList[j].spaceCount);
            arrayApplicationCount.push(resultList[j].applicationCount);
            arrayUserCount.push(resultList[j].userCount);
          }
        }
      }

      arrayOrganizationName.join(',');
      arraySpaceCount.join(',');
      arrayApplicationCount.join(',');
      arrayUserCount.join(',');

      var chartColors = {
        red: 'rgb(255, 99, 132)',
        orange: 'rgb(255, 159, 64)',
        yellow: 'rgb(255, 205, 86)',
        green: 'rgb(75, 192, 192)',
        blue: 'rgb(54, 162, 235)',
        purple: 'rgb(153, 102, 255)',
        grey: 'rgb(201, 203, 207)'
      };

      var horizontalBarChartData = {
        labels: arrayOrganizationName,
        datasets: [
          {
            label: "APP",
            backgroundColor: Chart.helpers.color(chartColors.red).alpha(0.5).rgbString(), //"#00b0f0",
            borderColor: chartColors.red,
            borderWidth: 1,
            data: arrayApplicationCount //조직의 APP 수치
          },
          {
            label: "공간",
            backgroundColor: Chart.helpers.color(chartColors.blue).alpha(0.5).rgbString(), //"#00b0f0",
            borderColor: chartColors.blue,
            borderWidth: 1,
            data: arraySpaceCount  // 조작의 공간 수치
          },
          {
            label: "사용자",
            backgroundColor: Chart.helpers.color(chartColors.purple).alpha(0.5).rgbString(), //"#00b0f0",
            borderColor: chartColors.purple,
            borderWidth: 1,
            data: arrayUserCount  // 조직의 사용자 수
          }
        ]
      };

    //차트 그리기
    var ctx = document.getElementById("barChart").getContext("2d");
    var myHorizontalBar = new Chart(ctx, {
      type: 'horizontalBar',
      data: horizontalBarChartData,
      options: {

        elements: {
          rectangle: {
            borderWidth: 2,
          }
        },
        responsive: true,
        legend: {
          position: 'right', // display: false,
        },
        title: {
          display: false,
          text: 'Chart.js Horizontal Bar Chart'
        },
        scales: {
          yAxes:[{
            //barThickness: 20,
            ticks: {
              beginAtZero:true,
              mirror: false,
            },
          }],
        },

      }
    });

  };

  // '공간'차트 CALLBACK
  var procCallbackGetTotalSpaceList = function(data) {
    //setSpaceChart(data);
  };


//
//  $(function () {
//    /* ChartJS
//     * -------
//     * Here we will create a few charts using ChartJS
//     */
//
//    //-------------
//    //- BAR CHART -
//    //-------------
//    var barChartCanvas = $('#barChart').get(0).getContext('2d');
//    var barChart = new Chart(barChartCanvas);
//
//
//    var barChartData = {
//      labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
//      datasets: [
//        {
//          label: 'Electronics',
//          fillColor: 'rgba(210, 214, 222, 1)',
//          strokeColor: 'rgba(210, 214, 222, 1)',
//          pointColor: 'rgba(210, 214, 222, 1)',
//          pointStrokeColor: '#c1c7d1',
//          pointHighlightFill: '#fff',
//          pointHighlightStroke: 'rgba(220,220,220,1)',
//          data: [65, 59, 80, 81, 56, 55, 40]
//        },
//        {
//          label: 'Digital Goods',
//          fillColor: 'rgba(60,141,188,0.9)',
//          strokeColor: 'rgba(60,141,188,0.8)',
//          pointColor: '#3b8bba',
//          pointStrokeColor: 'rgba(60,141,188,1)',
//          pointHighlightFill: '#fff',
//          pointHighlightStroke: 'rgba(60,141,188,1)',
//          data: [28, 48, 40, 19, 86, 27, 90]
//        }
//      ]
//    }
//
//    barChartData.datasets[1].fillColor = '#00a65a'
//    barChartData.datasets[1].strokeColor = '#00a65a'
//    barChartData.datasets[1].pointColor = '#00a65a'
//    var barChartOptions = {
//      //Boolean - Whether the scale should start at zero, or an order of magnitude down from the lowest value
//      scaleBeginAtZero: true,
//      //Boolean - Whether grid lines are shown across the chart
//      scaleShowGridLines: true,
//      //String - Colour of the grid lines
//      scaleGridLineColor: 'rgba(0,0,0,.05)',
//      //Number - Width of the grid lines
//      scaleGridLineWidth: 1,
//      //Boolean - Whether to show horizontal lines (except X axis)
//      scaleShowHorizontalLines: true,
//      //Boolean - Whether to show vertical lines (except Y axis)
//      scaleShowVerticalLines: true,
//      //Boolean - If there is a stroke on each bar
//      barShowStroke: true,
//      //Number - Pixel width of the bar stroke
//      barStrokeWidth: 2,
//      //Number - Spacing between each of the X value sets
//      barValueSpacing: 5,
//      //Number - Spacing between data sets within X values
//      barDatasetSpacing: 1,
//      //Boolean - whether to make the chart responsive
//      responsive: true,
//      maintainAspectRatio: true
//    }
//
//    barChartOptions.datasetFill = false
//    barChart.Bar(barChartData, barChartOptions)
//  })

  /*]]>*/
</script>


</body>
</html>
