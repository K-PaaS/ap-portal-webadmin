<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="../layout/default">
<head>
</head>
<body>
<div class="wrapper">
    <header></header>
    <!-- Left side column. contains the logo and sidebar -->
    <!-- Content Wrapper. Contains page content -->
        <!-- ===================================================================================== -->
        <!-- Content Header (Page header) -->
        <div layout:fragment="content">
            <section class="content-header">
            <h3>
                설정 정보
            </h3>
        </section>

        <!-- Main content -->
        <section class="content">
            <div class="box box-default" >
                <!-- /.box box-default-header -->
                <div class="col-sm-6 pt5">
                    <h3>인프라 설정</h3>
                </div>
                <div style="padding:10px;">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <td width="15%" style="vertical-align: middle">Name</td>
                            <td width="23%" style="vertical-align: middle">API_URI</td>
                            <td width="23%" style="vertical-align: middle">UAA_URI</td>
                            <td width="23%" style="vertical-align: middle">Authorization</td>
                            <td width="12%" style="vertical-align: middle">/</td>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="config : ${configs}">
                            <td th:text="${config.name}"></td>
                            <td th:text="${config.apiUri}"></td>
                            <td th:text="${config.uaaUri}"></td>
                            <td th:text="${config.authorization}"></td>
                            <td style="text-align: center;"><div class="divButtons"><button class="btn btn-del" >삭제</button></div></td>
                        </tr>

                        </tbody>
                    </table>
                </div>

            </div>
        </section>
        <!-- /.content -->
        <!-- ===================================================================================== -->
    </div>
    <!-- /.content-wrapper -->

    <!--footer -->



    <!-- Control Sidebar -->
    <!-- /.control-sidebar -->

    <!-- Add the sidebar's background. This div must be placed
         immediately after the control sidebar -->
    <!--<div class="control-sidebar-bg"></div>-->
<!-- ./wrapper -->
    <footer></footer>
</div>
<script th:inline="javascript" type="text/javascript" layout:fragment="custom-script">
    var V2_URL = "/v2";
    var REST_URL = V2_URL + "/configInfos"

    $(document).ready(function(){
        getValues();
    });

    function getValues(){

        $.ajax({
            url: REST_URL,
            dataType: 'json',
            success: function(data){
                if(data.list){
                    $.each(data.list, function (id, data) {
                        $('#'+data.name).val(data.value);
                    });
                }
            }
        });
    }

    function getValue(name)
    {
        $.ajax({
            url: REST_URL + "/" + name,
            method: "GET",
            dataType: 'json',
            success: function(data){
                if(data.list){
                    $.each(data.list, function (id, data) {
                        $("#beforename").html(data.value);
                    });
                }
            }
        });
    }

    function initmodal(Titlename, urlname, value)
    {
        $("#titlename").html(Titlename);
        $("#urlname").html(urlname);
        getValue(urlname);
        $("#aftername").html(value);
    }


    function updateValue(name, value){
        if (0 != value.length) {
            if (0 == value.replace(/ /g,"").length) {
                $('#' + name).focus();
                notifyAlert("warning", "" ,/*[[#{common.info.empty.req.data}]]*/ "");
                return false;
            }

            if (value.includes(' ')) {
                $('#' + name).focus();
                notifyAlert("warning", "" ,/*[[#{common.url.validation.error.message}]]*/ "");
                return false;
            }
            if(name!='smtp_url'){
                if (!procCheckValidUrl(value)) {
                    $('#' + name).focus();
                    notifyAlert("warning", "" ,/*[[#{common.url.validation.error.message}]]*/ "");
                    return false;
                }
            }
        } else {
            $('#' + name).focus();
            return false;
        }

        param = {
            value: value
        }

        $.ajax({
            url: REST_URL+"/"+name,
            method: "PUT",
            data: JSON.stringify(param),
            dataType: 'json',
            contentType: "application/json",
            success: function(data){
                if(data){
                    notifyAlert("success", "" ,"설정이 저장되었습니다.");
                }
            }
        });

    }


</script>
</body>
</html>
